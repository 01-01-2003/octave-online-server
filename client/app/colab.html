<!DOCTYPE html>
<html>
<head>
<title>Octave Online Colaboration Demo</title>

<!-- Pre-Load Spinner Image -->
<script>
new Image().src = "images/spinner.svg";
</script>

<style type="text/css">
#editor1{
	display: inline-block;
	width: 300px;
	height: 100px;
}
#editor2{
	display: inline-block;
	width: 300px;
	height: 100px;
}
</style>

</head>
<body>

<div id="editor1"></div>
<div id="editor2"></div>

<script type="text/javascript" src="vendor/requirejs/require.js"></script>
<script type="text/javascript" src="main.js"></script>
<script type="text/javascript">

var initialText = "lorem ipsum";

require(["ace/ace", "js/ot-client", "socket.io"], function(ace, Client, io){
	var editor1 = ace.edit("editor1");
	var editor2 = ace.edit("editor2");

	editor1.setValue(initialText);
	editor2.setValue(initialText);

	otClient1 = new Client();
	otClient2 = new Client();

	otClient1.attachEditor(editor1);
	otClient2.attachEditor(editor2);

	otClient1.addEventListener("send", function(revision, operation){
		console.log("client1 send", arguments);
		socket.emit("ot:change", {
			rev: revision,
			op: operation
		});
	});
	otClient1.addEventListener("cursor", function(cursor){
		console.log("client1 cursor", arguments);
		socket.emit("ot:cursor", cursor);
	});
	otClient2.addEventListener("send", function(){
		console.log("client2 send", arguments);
		socket.emit("ot:change", {
			rev: revision,
			op: operation
		});
	});

	var socket = window.socket = io();
	socket.emit("init");
	socket.on("ot:broadcast", function(obj){
		var op = ot.TextOperation.fromJSON(obj.op);
		otClient1.serverAck();
		//otClient1.applyServer(op);
		otClient2.applyServer(op);
	});
	socket.on("ot:cursor", function(cursor){
		otClient2.adapter.setOtherCursor(cursor, "#F00", "foo");
	})
});

</script>

</body>
</html>